<?xml version="1.0" encoding="UTF-8"?>
<openerp>
  <data>
    <!-- the sequence of the configuration sub menu is 30 -->
    <menuitem id='crm.root_menu'
	      name='Tools'
	      parent='base.menu_base_partner'
	      sequence="25"/>

    <record model="ir.actions.act_window" id="xopgi_partner_merge_act">
      <field name="name">Deduplicate contacts</field>
      <field name="res_model">xopgi.partner.merge.wizard</field>
      <field name="view_type">form</field>
      <field name="view_mode">form</field>
      <field name="target">new</field>
      <field name="context">{'active_test': False}</field>
    </record>

    <menuitem id='crm.partner_merge_automatic_menu'
	      action='xopgi_partner_merge_act'
	      groups='base.group_system'
	      parent='crm.root_menu' />

    <record model='ir.ui.view' id='xopgi_partner_merge_wizard_form'>
      <field name='name'>xopgi.partner.merge.wizard.form</field>
      <field name='model'>xopgi.partner.merge.wizard</field>
      <field name='arch' type='xml'>
	<form string='Merge Wizard' version="7.0">
	  <header>
	    <button
		name='start_process_cb'
		string='Search for similar partners'
		type='object'
		class='oe_highlight'
		/>
	    <span class="or_cancel">
	      or
	      <button
		  name="close_cb"
		  special="nosave"
		  string="Cancel"
		  type="object"
		  class="oe_link oe_inline"
		  />
	    </span>
	  </header>
	  <sheet>
	    <p class="oe_grey">
	      Select the list of fields used to search for
	      duplicated records. If you select several fields,
	      Odoo will propose you to merge only those having
	      all these fields in common. (not one of the fields).
	    </p>
	    <group string="Filter by">
	      <field name='filter_by_name' />
	    </group>
	    <group string="Search duplicates based on duplicated data in">
	      <field name='group_by_name' />
	      <field name='group_by_email' />
	      <field name='group_by_is_company' />
	      <field name='group_by_vat' />
	      <field name='group_by_parent_id' />
	    </group>
	    <group string="Exclude contacts having">
	      <field name='exclude_contact' />
	      <field name='exclude_journal_item' />
	    </group>
	    <separator string="Options"/>
	    <group>
	      <field name='maximum_group'/>
	    </group>
	  </sheet>
	</form>
      </field>
    </record>

    <record model='ir.ui.view' id='xopgi_partner_merge_group_form'>
      <field name='name'>xopgi.partner.merge.group.form</field>
      <field name='model'>xopgi.partner.merge.group</field>
      <field name='arch' type='xml'>
	<form string='Partner group' version="7.0">
	  <header>
	    <button
		name='merge'
		string='Merge'
		type='object'
		class='oe_highlight'
		/>
	  </header>
	  <group>
	    <field
		name="dest_partner_id"
		string="Destination partner"
		></field>
	  </group>
	  <group string="Partners to merge">
	    <field name="partner_ids">
	      <tree>
		<field name="name"></field>
		<field name="phone"></field>
		<field name="mobile"></field>
		<field name="email"></field>
		<field name="is_company"></field>
	      </tree>
	    </field>
	  </group>
	</form>
      </field>
    </record>

    <act_window
	id="action_partner_merge"
	res_model="xopgi.partner.merge.group"
	src_model="res.partner"
	multi="True"
	key2="client_action_multi"
	context="{
		 'dest_partner_id': active_id,
		 'partner_ids': active_ids
		 }"
	view_mode="form"
	name="Merge"
	/>

  </data>

</openerp>
